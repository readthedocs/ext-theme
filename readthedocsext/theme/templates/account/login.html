{% extends "account/base.html" %}

{% load account socialaccount %}
{% load crispy_forms_tags %}
{% load i18n %}

{% block head_title %}{% trans "Log in" %}{% endblock %}

{% block content %}
  <div class="ui stackable padded grid">

    <div class="violet four wide computer only column"></div>

    <div class="twelve wide computer sixteen wide tablet sixteen wide mobile column">
      {% get_providers as socialaccount_providers %}

      <div class="ui medium header">
        {% block authentication_header %}
          {% if is_from_cas_login %}
            {% trans "Log in to view this documentation" %}
          {% else %}
            {% trans "Log in to continue" %}
          {% endif %}
        {% endblock authentication_header %}
      </div>

      <div class="ui small stackable secondary two item menu" data-bind="semanticui: {tabs: {history: true, autoTabActivation: false}}">

        {# This is purposely minimal, as the verbiage for "Log in with connected account" is a mountful #}
        <a class="item" data-tab="vcs">
          <i class="fad fa-cloud icon"></i>
          {% block authentication_vcs_text %}{% trans "Connected account" %}{% endblock %}
        </a>

        {% if not allowed_providers %}
        {# If allowed providers is given, don't show the username/password form #}
          <a class="item" data-tab="email">
            <i class="fad fa-envelope icon"></i>
            {% block authentication_email_text %}{% trans "Log in with email" %}{% endblock %}
          </a>
        {% endif %}
      </div>

      <div class="ui basic center aligned tab segment" data-tab="vcs">
        <div class="ui relaxed list">
          {% block authentication_vcs %}
            {# Translators: this will read "Log in with GitHub", where "log in" is a verb #}
            {% blocktrans asvar text_log_in %}Log in using{% endblocktrans %}
            {% include "socialaccount/snippets/provider_list.html" with process="login" verbiage=text_log_in %}
          {% endblock authentication_vcs %}
        </div>
      </div>
      <div class="ui basic vertically fitted tab segment" data-tab="email">
        {% block authentication_email %}
          <p class="ui center aligned vertically fitted small basic fluid segment">
            {# The /email addition is to route to the tab page on the login/signup forms, using the tab module history setting #}
            {% blocktrans trimmed %}
              Need an account? <a href="{{ signup_url }}#/email">Sign up</a> first.
            {% endblocktrans %}
          </p>

          <form class="ui form" method="post" action="{% url "account_login" %}#/email">
            {% csrf_token %}
            {{ form|crispy }}
            {% if redirect_field_value %}
              <input type="hidden" name="{{ redirect_field_name }}" value="{{ redirect_field_value }}" />
            {% endif %}

            <a class="ui small text" href="{% url 'account_reset_password' %}">{% trans "Forgot your password?" %}</a>
            <button class="ui primary right cleared floated button" type="submit">
              {% trans "Log in" %}
            </button>

          </form>
        {% endblock authentication_email %}
      </div>

      {% if project_password_url %}
      {# TODO: make this look nicer! #}
      <div>
        {% blocktrans trimmed with project_password_url=project_password_url %}
        Do you have a password to access this documentation?
        <a href="{{ project_password_url }}">Access here</a>.
        {% endblocktrans %}
      </div>
      {% endif %}

      {% block authentication_extra %}{% endblock %}

    </div>
  </div>
{% endblock content %}
