<html>
  <body>
    <div data-bind="using: TestView()">
      <script type="application/json" data-bind="jsonInit: configJson">
        { "test": true }
      </script>
      <script type="text/plain" data-bind="textInit: configText">
        { "test": true }
      </script>
      <script type="text/html" data-bind="htmlInit: configHtml">
        <test true></test>
      </script>
      <input value="test: true" data-bind="valueInit: configValue" />
    </div>
    <script type="module">
      import { expect } from "@open-wc/testing";
      import { runTests } from "@web/test-runner-mocha";
      import { default as ko } from "knockout";

      import { Application } from "../../application";
      import { Registry } from "../../application/registry";

      // Promises for async test assertions
      let promiseJson;
      let promiseHtml;
      let promiseText;
      let promiseValue;

      const app = new Application();

      class TestView {
        static view_name = "TestView";

        constructor() {
          this.configJson = ko.observable();
          promiseJson = new Promise((resolve) => {
            this.configJson.subscribe((value) => {
              resolve(value);
            });
          });

          this.configText = ko.observable();
          promiseText = new Promise((resolve) => {
            this.configText.subscribe((value) => {
              resolve(value);
            });
          });

          this.configHtml = ko.observable();
          promiseHtml = new Promise((resolve) => {
            this.configHtml.subscribe((value) => {
              resolve(value);
            });
          });

          this.configValue = ko.observable();
          promiseValue = new Promise((resolve) => {
            this.configValue.subscribe((value) => {
              resolve(value);
            });
          });
        }
      }

      Registry.add_view(TestView);
      app.run();

      runTests(async () => {
        describe("Knockout init plugin", () => {
          it("loads Json", async () => {
            const dataJson = await promiseJson;
            expect(dataJson).to.deep.equal({ test: true });
          });
          it("loads Text", async () => {
            const dataText = await promiseText;
            expect(dataText).to.include('{ "test": true }');
          });
          it("loads Html", async () => {
            const dataHtml = await promiseHtml;
            expect(dataHtml).to.include("<test true></test>");
          });
          it("loads Value", async () => {
            const dataValue = await promiseValue;
            expect(dataValue).to.deep.equal("test: true");
          });
        });
      });
    </script>
  </body>
</html>
